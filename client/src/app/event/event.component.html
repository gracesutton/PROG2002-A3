<head>
  <title>Event Details</title>
</head>
<body>

  <!-- Event Display -->
  <section id="event-page">
    <div id="leftColumn">
      <div id="eventDetailsDiv"></div>
        <button id="registerButton" onclick="alert('This feature is currently under construction.');">Register</button>
    </div>

    <div id="rightColumn">
      <div id="eventImageDiv"></div>
      <div id="goal-progress-div"></div>
      <div id="orgDetailsDiv"></div>
    </div>
  </section>

  <script>
    // Get the event ID from the query string (e.g. ?id=1)
    const params = new URLSearchParams(window.location.search);
    const eventID = params.get('id');

    if (!eventID) {
      document.getElementById('eventDetailsDiv').innerHTML = "<p>No event selected.</p>";
    } else {

    // Fetch upcoming events
    fetch('http://localhost:8080/api/events/'+eventID)
      .then(response => response.json())
      .then(data => {

        if (!data || data.length === 0) {
          document.getElementById('eventDetailsDiv').innerHTML = "<p>Event not found.</p>";
          return;
        }

        // If data is an array, take the first element
        const event = Array.isArray(data) ? data[0] : data;

        const eventDetailsDiv = document.getElementById('eventDetailsDiv');
        const orgDetailsDiv = document.getElementById('orgDetailsDiv');
        const goalProgressDiv = document.getElementById('goal-progress-div');
        const eventImageDiv = document.getElementById('eventImageDiv');

        // Determine ticket price display
        let ticketPrice;
        if (event.TicketPrice == 0) {
          ticketPrice = "Free";
        } else {
          ticketPrice = event.TicketPrice;
        }

        // Populate event details
        eventDetailsDiv.innerHTML = `
          <h2>${event.EventName}</h2>
          <p>${event.Description}</p>
          <p>Date: ${new Date(event.EventDate).toLocaleDateString()}</p>
          <p>Location: ${event.Location}</p>
          <p>Ticket Price: ${ticketPrice}</p>
        `;

        // add category image
        const img = document.createElement('img');
        img.src = event.CategoryImage;
        img.className = 'category-image';
        eventImageDiv.appendChild(img);

        // Populate organiser details
        orgDetailsDiv.innerHTML = `
          <h4>Organiser Details</h4>
          <p>Name: ${event.OrganisationName}</p>
          <p>Description: ${event.OrganisationDescription}</p>
          <p>Website: ${event.Website}</p>
          <p>Contact: ${event.Phone}</p>
        `;

        // Populate goal progress
        goalProgressDiv.innerHTML = `
          <h4>Goal Progress</h4>
          <p>Goal Amount: ${event.GoalAmount}</p>
          <p>Current Progress: ${event.CurrentProgress}</p>
          <p>${((event.CurrentProgress / event.GoalAmount) * 100).toFixed(2)}% of goal reached</p>
        `;
        })
      .catch(error => {
        console.error('Error fetching events:', error);
        document.getElementById('eventDetailsDiv').innerHTML = "Failed to load event";
      });
    }

  </script>

</body>