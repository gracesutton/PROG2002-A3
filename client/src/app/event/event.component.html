<head>
  <title>Event Details</title>
</head>

<body>

  <!-- Event Display -->
  <section id="event-page" *ngIf="!loading && event; else loadingOrError">

    <div id="leftColumn">
      <div id="eventDetailsDiv">
        <h2>{{ event.EventName }}</h2>
        <p>{{ event.Description }}</p>
        <p *ngIf="event.EndDate && event.EndDate !== event.EventDate">
          Date: {{ event.EventDate | date:'longDate' }} - {{ event.EndDate | date:'longDate' }}
        </p>
        <p *ngIf="!event.EndDate || event.EndDate === event.EventDate">
          Date: {{ event.EventDate | date:'longDate' }}
        </p>
        <p *ngIf="event.StartTime">Time: {{ event.StartTime | timeFormat }} <span *ngIf="event?.EndTime"> - {{ event.EndTime | timeFormat }}</span> </p>
        <p>Location: {{ event.Location }}</p>
        <p>Ticket Price: {{ event.TicketPrice == 0 ? 'Free' : ('$' + event.TicketPrice) }}</p>
      </div>

      <button id="registerButton" [routerLink]="['/register', event.EventID]">Register</button>
      
      <h3>Registrations</h3>
      <div *ngIf="registrations?.length; else noRegos" class="registrations-list">
        <ul>
          <li *ngFor="let r of registrations" class="registration-item">
            <strong>{{ r.FullName }}</strong> purchased <strong>{{ r.Tickets }} ticket(s)</strong> on {{ r.CreatedAt | date:'fullDate' }}
          </li>
        </ul>
      </div>
      
      <ng-template #noRegos>
        <p>There are no registrations yet for this event.</p>
      </ng-template>
    </div>

    <div id="rightColumn">
      <div id="eventImageDiv">
        <img [src]="event.CategoryImage" [alt]="event.EventName" class="category-image" />
      </div>
      <div id="goal-progress-div">
        <h4>Goal Progress</h4>
        <p>Goal Amount: ${{ event.GoalAmount }}</p>
        <p>Current Progress: ${{ event.CurrentProgress }}</p>
        <p>{{ ((event.CurrentProgress ?? 0) / (event.GoalAmount ?? 1) * 100).toFixed(0) }}% of goal reached</p>
      </div>
      <div id="orgDetailsDiv">
        <h4>Organiser Details</h4>
        <p>Name: {{ event.OrganisationName }}</p>
        <p>Description: {{ event.OrganisationDescription }}</p>
        <p>Website: {{ event.Website }}</p>
        <p>Contact: {{ event.Phone }}</p>
      </div>
    </div>
  </section>

  <ng-template #loadingOrError>
    <p *ngIf="loading">Loading event...</p>
    <p *ngIf="!loading && errorMsg">{{ errorMsg }}</p>
  </ng-template>

</body>