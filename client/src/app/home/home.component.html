<head>
    <title>Home page</title>
</head>

<body>
    <!-- Page Welcome Message -->
    <section id="msg">
        <p>Hi, and welcome to Gold Coast Charity Connect! The one place to find out about local charity events in our
            area.
        </p>
        <p>Click on an event to learn more and register!</p>
    </section>

    <!-- Upcoming Events -->
    <h2>Upcoming Events</h2>
    <section id="upcoming-events-box">
        <div id="upcomingEventsDiv"></div>
    </section>
    
    <!-- Past Events -->
    <h2>Past Events</h2>
    <section id="past-events-box">
        <div id="pastEventsDiv"></div>
    </section>

    <script>
        // Fetch upcoming events
        fetch('http://localhost:8080/api/events')
            .then(response => response.json())
            .then(data => {

                // clear existing content
                const upcomingEventsDiv = document.getElementById('upcomingEventsDiv');
                const pastEventsDiv = document.getElementById('pastEventsDiv');
                upcomingEventsDiv.innerHTML = "";
                pastEventsDiv.innerHTML = "";

                // get today's date at midnight
                const today = new Date();
                today.setHours(0, 0, 0, 0); // normalise to midnight

                if (data.length > 0) {
                    data.forEach(event => {

                        // normalise event date to midnight for comparison
                        const eventDate = new Date(event.EventDate);
                        eventDate.setHours(0, 0, 0, 0);

                        // creat event wrapper
                        const eventDiv = document.createElement('div');
                        eventDiv.className = 'event';

                        // add category image
                        const img = document.createElement('img');
                        img.src = event.CategoryImage;
                        img.className = 'category-image';
                        eventDiv.appendChild(img);

                        // add event details
                        const eventDetails = document.createElement('div');
                        eventDetails.className = 'event-details';
                        eventDetails.innerHTML = `
                <h3><a href="/event?id=${event.EventID}">${event.EventName}</a></h3>
                <p>${event.Description}</p>
                <p>Date: ${new Date(event.EventDate).toLocaleDateString()}</p>
                <p>Location: ${event.Location}</p>
              `;
                        eventDiv.appendChild(eventDetails);

                        // append to upcoming or past section
                        if (eventDate >= today) {
                            upcomingEventsDiv.appendChild(eventDiv);
                        } else {
                            pastEventsDiv.appendChild(eventDiv);
                        }
                    });
                } else {
                    upcomingEventsDiv.innerHTML = "No events to show";
                    pastEventsDiv.innerHTML = "No events to show";
                }
            })
            .catch(error => {
                console.error('Error fetching events:', error);
                document.getElementById('upcomingEventsDiv').innerHTML = "Failed to load events";
                document.getElementById('pastEventsDiv').innerHTML = "Failed to load events";
            });

    </script>

</body>